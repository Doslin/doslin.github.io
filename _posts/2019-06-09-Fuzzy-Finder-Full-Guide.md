---
layout: post
title: 'Fuzzy finder(fzf+vim) ä½¿ç”¨å…¨æŒ‡å—'
description: "Fuzzy finder(fzf+vim) ä½¿ç”¨å…¨æŒ‡å—"
author: qiuzhilin
tags: 
  - Tools
last_modified_at: 2019-06-09T13:46:18-05:00
---

## ç®€ä»‹

[Fuzzy finder](https://github.com/junegunn/fzf) æ˜¯ä¸€æ¬¾ä½¿ç”¨ GO è¯­è¨€ç¼–å†™çš„äº¤äº’å¼çš„ Unix å‘½ä»¤è¡Œå·¥å…·ã€‚å¯ä»¥ç”¨æ¥æŸ¥æ‰¾ä»»ä½• **åˆ—è¡¨** å†…å®¹ï¼Œæ–‡ä»¶ã€Git åˆ†æ”¯ã€è¿›ç¨‹ç­‰ã€‚æ‰€æœ‰çš„å‘½ä»¤è¡Œå·¥å…·å¯ä»¥ç”Ÿæˆåˆ—è¡¨è¾“å‡ºçš„éƒ½å¯ä»¥å†é€šè¿‡ç®¡é“ pipe åˆ° fzf ä¸Šè¿›è¡Œæœç´¢å’ŒæŸ¥æ‰¾

## ä¼˜ç‚¹

- GO è¯­è¨€ç¼–å†™ï¼Œç¼–è¯‘å®Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰ä»»ä½•ä¾èµ–
- æœç´¢/æŸ¥æ‰¾é€Ÿåº¦é£å¿«
- åŠŸèƒ½å…¨é¢/å¯è§†åŒ–ç•Œé¢ä½“éªŒå¾ˆæ£’
- å‘¨è¾¹æ’ä»¶ä¸°å¯Œ (vim, tmux, fuzzy auto-completion)

## å®‰è£…

ä»¥ macOS ä¸ºä¾‹å­ï¼Œç›´æ¥ä½¿ç”¨ homebrew å®‰è£…å³å¯

```bash
brew install fzf
# å¦‚æœè¦ä½¿ç”¨å†…ç½®çš„å¿«æ·é”®ç»‘å®šå’Œå‘½ä»¤è¡Œè‡ªåŠ¨å®ŒæˆåŠŸèƒ½çš„è¯å¯ä»¥æŒ‰éœ€å®‰è£…
$(brew --prefix)/opt/fzf/install
```

## ä½¿ç”¨

å‘½ä»¤è¡Œä¸‹æ‰§è¡Œ `fzf` å³å¯å±•ç¤ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥ç”¨é”®ç›˜ä¸Šä¸‹é”®æˆ–è€…é¼ æ ‡ç‚¹å‡ºæ¥é€‰æ‹© [![fzf-normal](https://img10.360buyimg.com/devfe/jfs/t26002/277/432949068/59208/9725245b/5b6fc71fN03036763.png)](https://img10.360buyimg.com/devfe/jfs/t26002/277/432949068/59208/9725245b/5b6fc71fN03036763.png)

æˆ–è®¸ä½ ä¼šè§‰å¾—è¿™ä¸ªæŸ¥æ‰¾æç¤ºçœ‹èµ·æ¥æŒºæ¼‚äº®çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œå› ä¸ºæŸ¥æ‰¾å‡ºæ¥å°±æ²¡æœ‰ç„¶åäº†ã€‚å…¶å®è¿™ä¹Ÿæ˜¯ Fuzzy finder æœ€æ ¸å¿ƒçš„åœ°æ–¹ï¼Œä»–åªæ˜¯ä¸€ä¸ªé€šç”¨çš„ä¸‹æ‹‰æŸ¥æ‰¾åŠŸèƒ½ï¼Œè‡ªå·±æœ¬èº«å¹¶ä¸å…³å¿ƒä½ ç”¨å®ƒæ¥åšä»€ä¹ˆï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦ç»„åˆä½¿ç”¨æ‰ä¼šæœ‰å¾ˆå¥½çš„æ•ˆæœ

### ç”¨ vim æ‰“å¼€æ–‡ä»¶

æ¯”å¦‚æˆ‘ä»¬ç”¨ vim ç»„åˆ fzf æ¥æŸ¥æ‰¾å¹¶æ‰“å¼€ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š

```bash
vim $(fzf)
```

![fzf-vim](https://img30.360buyimg.com/devfe/jfs/t25372/5/461999989/83158/3ce44a5/5b6fc7f2Nd6432499.gif)

### åˆ‡æ¢å½“å‰å·¥ä½œç›®å½•

å†æ¯”å¦‚è¿›å…¥åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œä½¿ç”¨ fzf çš„è¿‡æ»¤é€‰æ‹©çœŸæ˜¯å¤ªæ–¹ä¾¿äº†

```bash
cd $(find * -type d | fzf)
```

è¿™æ˜¯ä¸ªç»„åˆ (cd+find+fzf) å‘½ä»¤ï¼Œå®Œæˆåˆ‡æ¢åˆ°ä»»æ„å­ç›®å½•çš„åŠŸèƒ½ã€‚å¯ä»¥çœ‹å‡ºæ¥å½“ fzf å’Œå…¶å®ƒå‘½ä»¤ç»„åˆä½¿ç”¨æ—¶å°±èƒ½ä½¿å¾—ä¸€äº›æ“ä½œæ›´æ–¹ä¾¿ï¼š

1. ä½¿ç”¨ find å‘½ä»¤æ‰¾å‡ºæ‰€æœ‰çš„å­ç›®å½•
2. æŠŠå­ç›®å½•åˆ—è¡¨ pipe åˆ° fzf ä¸Šè¿›è¡Œé€‰æ‹©
3. å†æŠŠç»“æœä»¥å­å‘½ä»¤çš„å½¢å¼ä¼ ç»™ cd

![fzf-find-cd](https://img13.360buyimg.com/devfe/jfs/t23848/96/1951894215/50884/20a513d7/5b6fcabbNb77c46d5.gif)

### åˆ‡æ¢ git åˆ†æ”¯

```bash
git checkout $(git branch -r | fzf)
```

![fzf-git-branch](https://img10.360buyimg.com/devfe/jfs/t23242/262/2000817850/127859/c0955478/5b6fce70N3c3573ae.gif)

ä¸è¿‡è¿™æ ·ç»„åˆä½¿ç”¨å‘½ä»¤çš„å®åœ¨å¤ªé•¿äº†ï¼Œå¦‚æœä½ ä¸ä½¿ç”¨è‡ªåŠ¨è¡¥å…¨çš„è¯å·§èµ·æ¥å¾ˆç´¯çš„ã€‚å»ºè®®æŠŠå¸¸ç”¨çš„ alias æ”¾åœ¨ .zshrc ä¸­ç®¡ç†å˜›

### shell å‘½ä»¤è¡Œè¡¥å…¨

fzf é»˜è®¤ä½¿ç”¨ `**` æ¥è¡¥å…¨ shell å‘½ä»¤ï¼Œæ¯”èµ·é»˜è®¤çš„ tab è¡¥å…¨ï¼Œfzf è¡¥å…¨ä¸çŸ¥é“é«˜åˆ°å“ªé‡Œå»äº†ã€‚cd, vim, kill, ssh, exportâ€¦ ç»Ÿç»Ÿéƒ½èƒ½è¡¥å…¨ï¼Œå¥½ç”¨å“­äº† ğŸ¤£

![fzf-completion](https://img10.360buyimg.com/devfe/jfs/t24820/280/435378103/490486/3777afba/5b6fedc6N59529380.gif)

## é…ç½®

fzf æä¾›äº†ä¸¤ä¸ª *ç¯å¢ƒå˜é‡* é…ç½®å‚æ•°ï¼Œæ¥åˆ†åˆ«è®¾ç½®é»˜è®¤çš„è°ƒç”¨å‘½ä»¤å’Œ fzf é»˜è®¤é…ç½®å‚æ•°

### æ ¸å¿ƒå‘½ä»¤ FZF_DEFAULT_COMMAND

å¯¹äºä½¿ç”¨ fzf æ¥æŸ¥æ‰¾æ–‡ä»¶çš„æƒ…å†µï¼Œfzf å…¶å®åº•å±‚æ˜¯è°ƒç”¨çš„ Unix ç³»ç»Ÿ `find` å‘½ä»¤ï¼Œå¦‚æœä½ è§‰å¾— find ä¸å¥½ç”¨ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒæŸ¥æ‰¾æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€Œæˆ‘ä½¿ç”¨ [fd](https://github.com/sharkdp/fd)ã€ã€‚æ³¨æ„ï¼šå¯¹åŸå§‹å‘½ä»¤æ·»åŠ ä¸€äº›å‚æ•°åº”è¯¥åœ¨è¿™ä¸ªç¯å¢ƒå˜é‡é‡Œé¢æ·»åŠ 

æ¯”å¦‚è¯´æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šæŸ¥æ‰¾æ–‡ä»¶ `-type f`ï¼Œé€šå¸¸ä¼šå¿½ç•¥ä¸€äº›æ–‡ä»¶å¤¹/ç›®å½• `--exclude=...`ï¼Œä¸‹é¢æ˜¯æˆ‘çš„å˜é‡å€¼ï¼š

```bash
export FZF_DEFAULT_COMMAND="fd --exclude={.git,.idea,.vscode,.sass-cache,node_modules,build} --type f"
```

### ç•Œé¢å±•ç¤º FZF_DEFAULT_OPTS

ç•Œé¢å±•ç¤ºè¿™äº›å‚æ•°åœ¨ `fzf --help` ä¸­éƒ½æœ‰ï¼ŒæŒ‰éœ€é…ç½®å³å¯

```bash
export FZF_DEFAULT_OPTS="--height 40% --layout=reverse --preview '(highlight -O ansi {} || cat {}) 2> /dev/null | head -500'"
```

ç•Œé¢é…ç½®å‚æ•°åŠ ä¸Šåå°±æ¼‚äº®å¤šäº† [![fzf-with-preview](https://img11.360buyimg.com/devfe/jfs/t24178/228/1983729650/93496/412c5c52/5b6fd697N0d686b66.png)](https://img11.360buyimg.com/devfe/jfs/t24178/228/1983729650/93496/412c5c52/5b6fd697N0d686b66.png)

`--preview` è¡¨ç¤ºåœ¨å³ä¾§æ˜¾ç¤ºæ–‡ä»¶çš„é¢„è§ˆç•Œé¢ï¼Œè¯­æ³•é«˜äº®çš„è®¾ç½®ä½¿ç”¨äº† [highlight](http://www.andre-simon.de/doku/highlight/en/highlight.php) å¦‚æœ highlight å¤±è´¥åˆ™ä½¿ç”¨æœ€å¸¸è§çš„ `cat` å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹

highlight å®‰è£…å¯èƒ½ä¼šæœ‰ä¸ªå°æ’æ›²ã€‚highlight éœ€è¦æ‰‹åŠ¨ç¼–è¯‘å®‰è£…ï¼Œé»˜è®¤å®‰è£…ç›®å½•åœ¨ `/usr/bin`, `/usr/share` ä¸‹é¢ã€‚ç„¶è€Œåœ¨ macOS ä¸­ç”±äº SIP ä¿æŠ¤ï¼Œç”¨æˆ·å®‰è£…çš„ç¨‹åºä¸èƒ½åœ¨è¿™å‡ ä¸ªç›®å½•ä¸‹é¢ã€Œå³ä½¿æœ‰ sudo æƒé™ä¹Ÿä¸è¡Œã€ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ›´æ”¹ä¸‹ highlight æºä»£ç ä¸­ makefile ä¸­çš„å‚æ•°å³å¯

```make
# PREFIX = /usr
PREFIX = /usr/local
```

å°† `PREFIX = /usr` æ”¹æˆ `PREFIX = /usr/local`ï¼Œç„¶å `make`ï¼Œ`sudo make install` å°±å¯ä»¥äº†

### è§¦å‘å‘½ä»¤è¡Œè¡¥å…¨ FZF_COMPLETION_TRIGGER

é»˜è®¤æ˜¯ `**`ï¼Œä¸€èˆ¬ä¸ç”¨ä¿®æ”¹

## VIM fzf æ’ä»¶

å¦‚æœä½ ä½¿ç”¨ vimï¼Œé‚£ä¹ˆå®˜æ–¹æä¾›çš„æ’ä»¶ä¼šè®©ä½ çš„ vim ä½¿ç”¨æ›´åŠ æµç•…

### å®‰è£…æ’ä»¶

å¦‚æœä½ æœ¬åœ°å®‰è£…è¿‡ fzf å‘½ä»¤è¡Œå·¥å…·äº†ï¼Œåªéœ€è¦åœ¨ .vimrc é‡Œé¢æ·»åŠ ä¸‹é¢ä¸¤ä¸ªæ’ä»¶é…ç½®å³å¯

```vim
Plug '/usr/local/opt/fzf'
Plug 'junegunn/fzf.vim'
```

æ³¨æ„ï¼šä½¿ç”¨äº† [vim-plug](https://github.com/junegunn/vim-plug) æ’ä»¶ç®¡ç†

æ’ä»¶ä¸»è¦å¯¹ fzf é›†æˆç»‘å®šäº†ä¸€äº›å’Œ vim ç›¸å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šæŸ¥æ‰¾å½“å‰ Bufferã€Tagã€Marksã€‚ç”šè‡³åˆ‡æ¢ window æ›´æ¢ vim ä¸»é¢˜é…è‰²ç­‰

å‘½ä»¤æ¨¡å¼ä¸‹æ•² `Files` å³å¯é€‰æ‹©å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œ`Buffers` å¯ä»¥è¿‡æ»¤å½“å‰æ‰€æœ‰ vim buffer å†…å®¹

![fzf-vim-plugin](https://img10.360buyimg.com/devfe/jfs/t25240/349/434572567/558564/433c151a/5b6fdfadNfd6ea407.gif)

å†é…ç½®å‡ ä¸ªå¸¸ç”¨å¿«æ·é”®å°±å¯ä»¥ç›´æ¥å–ä»£ CtrlP æ’ä»¶äº† ğŸ¤”

- Ctrl + p æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
- Ctrl + e æŸ¥çœ‹å½“å‰ Bufferï¼Œä¸¤æ¬¡ Ctrl + e å¿«é€Ÿåˆ‡æ¢ä¸Šæ¬¡æ‰“å¼€çš„ Buffer

```vim
nmap <C-p> :Files<CR>
nmap <C-e> :Buffers<CR>
let g:fzf_action = { 'ctrl-e': 'edit' }
```

## ç»“è¯­

å½“ç„¶ fzf è¿˜å¯ä»¥åœ¨å¾ˆå¤šå…¶å®ƒåœºæ™¯ä¸‹ç”¨æ¥ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨å¯è§†åŒ–çš„åˆ—è¡¨é€‰æ‹©è€Œä¸æ˜¯å’£å’£æ•²å‘½ä»¤ï¼Œé‚£å°±è‡ªå·±æ­é…ä¸€äº›ç»„åˆæ¥ä½¿ç”¨å§